---
title: Provider API
description: HTTP and WebSocket provider interfaces for Starknet JSON-RPC.
---

<Info>
Source: [provider](https://github.com/enitrat/kundera/tree/main/packages/kundera-ts/src/provider)
</Info>

# Provider API

Providers are the primary interface for communicating with Starknet nodes. They wrap a transport with retry logic, timeout handling, and event emission, exposing a single `request()` method for all JSON-RPC calls.

## Imports

```typescript
import {
  HttpProvider,
  WebSocketProvider,
  type Provider,
  type TypedProvider,
  type StarknetRpcSchema,
  type RequestArguments,
  type RequestOptions,
  type RpcError,
  type ProviderEventMap
} from '@kundera-sn/kundera-ts/provider';
```

## Provider Interface

All providers implement this interface. The base `Provider` is untyped — `request()` returns `Promise<unknown>`. This is deliberate: the provider is a transport wrapper and makes no claims about what specific methods return.

```typescript
interface Provider {
  request(args: RequestArguments): Promise<unknown>;
  on<E extends ProviderEvent>(event: E, listener: ProviderEventMap[E]): this;
  removeListener<E extends ProviderEvent>(event: E, listener: ProviderEventMap[E]): this;
}

interface RequestArguments {
  readonly method: string;
  readonly params?: unknown[] | Record<string, unknown>;
}
```

## TypedProvider

`TypedProvider<TSchema>` is a generic interface that adds compile-time return type inference. When you pass a literal method string, TypeScript uses the schema to infer the correct return type.

```typescript
import { HttpProvider } from '@kundera-sn/kundera-ts/provider';
import type { TypedProvider, StarknetRpcSchema } from '@kundera-sn/kundera-ts/provider';

// Cast to get typed returns
const provider = new HttpProvider({
  url: 'https://api.zan.top/public/starknet-sepolia'
}) as TypedProvider<StarknetRpcSchema>;

// Return type inferred from schema
const chainId = await provider.request({
  method: 'starknet_chainId',
  params: []
});
// chainId: string

const block = await provider.request({
  method: 'starknet_getBlockWithTxHashes',
  params: [{ block_number: 12345 }]
});
// block: BlockWithTxHashes
```

The schema declares wire types only — the shapes defined by the Starknet JSON-RPC specification. It does not claim that responses contain rich domain types. See [Architecture](/overview/architecture) for the type honesty rationale.

The `<TMethod>` generic lives on the `request()` call, not on the class. This means a single provider instance can call any of the 37 methods, and each call gets the correct return type.

### StarknetRpcSchema

The built-in schema covering all Starknet JSON-RPC methods. Each entry maps a method name to its parameter tuple and wire return type.

```typescript
import type { StarknetRpcSchema } from '@kundera-sn/kundera-ts/provider';

// The schema is a readonly tuple type:
// readonly [
//   { Method: 'starknet_chainId'; Parameters: []; ReturnType: string },
//   { Method: 'starknet_blockNumber'; Parameters: []; ReturnType: number },
//   { Method: 'starknet_getBlockWithTxHashes'; Parameters: [BlockId]; ReturnType: BlockWithTxHashes },
//   ...37 total entries
// ]
```

### Custom Schemas

You can create custom schemas for non-standard RPC methods or testing.

```typescript
import type { RpcSchema, TypedProvider } from '@kundera-sn/kundera-ts/provider';

type MySchema = readonly [
  { Method: 'custom_method'; Parameters: [string]; ReturnType: { value: number } },
  ...StarknetRpcSchema,
];

const provider = new HttpProvider({ url: '...' }) as TypedProvider<MySchema>;
const result = await provider.request({ method: 'custom_method', params: ['arg'] });
// result: { value: number }
```

## HttpProvider

HTTP provider for request/response communication.

### Constructor

```typescript
new HttpProvider(options: HttpProviderOptions)
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `url` | `string` | required | JSON-RPC endpoint URL |
| `headers` | `Record<string, string>` | `{}` | Custom HTTP headers |
| `timeout` | `number` | `30000` | Request timeout in ms |
| `retry` | `number` | `0` | Number of retry attempts |
| `retryDelay` | `number` | `500` | Delay between retries in ms |

### Usage

```typescript
const provider = new HttpProvider({
  url: 'https://api.zan.top/public/starknet-sepolia',
  headers: { 'X-API-Key': 'your-key' },
  timeout: 30_000,
  retry: 2,
  retryDelay: 500
});
```

### request()

```typescript
provider.request(args: RequestArguments, options?: RequestOptions): Promise<unknown>
```

Sends a JSON-RPC request. Throws on JSON-RPC errors.

```typescript
import { Rpc } from '@kundera-sn/kundera-ts/jsonrpc';

const result = await provider.request(Rpc.BlockNumberRequest());

// With per-request overrides
const block = await provider.request(
  Rpc.GetBlockWithReceiptsRequest('latest'),
  { timeout: 60_000, retryCount: 3 }
);
```

### RequestOptions

Per-request overrides for timeout and retry behavior.

```typescript
interface RequestOptions {
  timeout?: number;
  retryCount?: number;
  retryDelay?: number;
}
```

## WebSocketProvider

WebSocket provider for real-time subscriptions and standard requests.

### Constructor

```typescript
new WebSocketProvider(options: WebSocketProviderOptions)
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `url` | `string` | required | WebSocket endpoint URL |
| `reconnect` | `boolean` | `true` | Auto-reconnect on disconnect |
| `reconnectDelay` | `number` | `1000` | Delay between reconnects in ms |
| `maxReconnectAttempts` | `number` | `5` | Maximum reconnect attempts |

### Connection

```typescript
const ws = new WebSocketProvider({
  url: 'wss://starknet-sepolia.example.com'
});

await ws.connect();
// ... use provider ...
ws.disconnect();
```

### Subscription Streams

The `events` property exposes async generators for Starknet subscriptions.

```typescript
// New block headers
for await (const head of ws.events.newHeads()) {
  // head: NewHead
}

// Contract events
for await (const event of ws.events.events({
  from_address: '0x...',
  keys: [['0x...']],
  block_id: 'latest'
})) {
  // event: EmittedEvent
}

// Pending transactions
for await (const tx of ws.events.pendingTransactions()) {
  // tx: PendingTransaction
}

// Transaction receipts
for await (const receipt of ws.events.transactionReceipts()) {
  // receipt: WsTransactionReceipt
}

// Transaction status updates
for await (const status of ws.events.transactionStatus(txHash)) {
  // status: TransactionStatusUpdate
}
```

### Connection Events

```typescript
ws.on('connect', (info) => { /* connected */ });
ws.on('disconnect', (error) => { /* disconnected */ });
ws.on('message', (message) => { /* raw message */ });
```

## Error Handling

Provider requests throw on JSON-RPC errors. The error object includes `code` and `message` properties.

```typescript
try {
  await provider.request(Rpc.GetTransactionReceiptRequest(txHash));
} catch (error) {
  // error.code: number
  // error.message: string
}
```

### Common Error Codes

| Code | Description |
|------|-------------|
| `-32601` | Method not found |
| `-32602` | Invalid params |
| `-32603` | Internal error |
| `20` | Contract not found |
| `21` | Block not found |
| `25` | Transaction hash not found |
| `29` | Contract error (execution failed) |
| `40` | Contract execution error |
| `41` | Invalid transaction nonce |

## Related

<CardGroup cols={2}>
  <Card title="Provider Guide" icon="plug" href="/guides/provider/providers">
    Patterns, recipes, and best practices.
  </Card>
  <Card title="JSON-RPC API" icon="code" href="/api/jsonrpc">
    Request builders and wire type reference.
  </Card>
  <Card title="Architecture" icon="sitemap" href="/overview/architecture">
    How providers fit in the layered stack.
  </Card>
  <Card title="Domain Primitives" icon="cube" href="/primitives/domain-primitives">
    Convert wire responses to rich domain types.
  </Card>
</CardGroup>
