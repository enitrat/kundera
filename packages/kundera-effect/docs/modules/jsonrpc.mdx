---
title: JSON-RPC
description: Free-function wrappers for every Starknet JSON-RPC method.
---

# JSON-RPC Module

The `JsonRpc` namespace provides one free function per Starknet RPC method. Every function returns `Effect<T, TransportError | RpcError, ProviderService>`.

This is the primary API for read operations. For writes, use [AccountService](/effect/services/account) or [ContractWriteService](/effect/services/contract-write).

## Imports

```typescript
import { JsonRpc } from "@kundera-sn/kundera-effect";
// or
import * as JsonRpc from "@kundera-sn/kundera-effect/jsonrpc";
```

## Basic Usage

```typescript
import { Effect } from "effect";
import { JsonRpc, Presets } from "@kundera-sn/kundera-effect";

const program = Effect.gen(function* () {
  const blockNum = yield* JsonRpc.blockNumber();
  const chainId = yield* JsonRpc.chainId();
  const block = yield* JsonRpc.getBlockWithTxs("latest");

  return { blockNum, chainId, block };
}).pipe(
  Effect.provide(Presets.SepoliaProvider())
);

const result = await Effect.runPromise(program);
```

## With Request Options

Every function accepts an optional `RequestOptions` as the last parameter. Policies are also composable via `withTimeout`, `withRetries`, etc:

```typescript
import { Services } from "@kundera-sn/kundera-effect";

// Via options parameter
const block = yield* JsonRpc.getBlockWithTxs("latest", { timeout: 5_000 });

// Via FiberRef policies
const block2 = yield* JsonRpc.getBlockWithTxs("latest").pipe(
  Services.withTimeout(5_000),
  Services.withRetries(2),
);
```

## Method Reference

### Chain Info

| Function | Return Type | Description |
|----------|-------------|-------------|
| `specVersion()` | `string` | RPC spec version |
| `chainId()` | `string` | Chain ID (hex-encoded) |
| `blockNumber()` | `number` | Latest block number |
| `blockHashAndNumber()` | `BlockHashAndNumber` | Latest block hash + number |
| `syncing()` | `SyncingStatus` | Node sync status |

### Blocks

| Function | Return Type | Description |
|----------|-------------|-------------|
| `getBlockWithTxHashes(blockId)` | `BlockWithTxHashes` | Block with transaction hashes only |
| `getBlockWithTxs(blockId)` | `BlockWithTxs` | Block with full transaction objects |
| `getBlockWithReceipts(blockId)` | `BlockWithReceipts` | Block with transactions and receipts |
| `getBlockTransactionCount(blockId)` | `number` | Transaction count in block |

### State

| Function | Return Type | Description |
|----------|-------------|-------------|
| `getStorageAt(address, key, blockId?)` | `string` | Storage value at key |
| `getNonce(address, blockId?)` | `string` | Account nonce |
| `getStateUpdate(blockId)` | `StateUpdate` | State diff for block |
| `getStorageProof(blockId, request?)` | `StorageProof` | Merkle proof for storage |

### Contracts

| Function | Return Type | Description |
|----------|-------------|-------------|
| `call(payload, blockId?)` | `string[]` | Execute read-only call |
| `getClass(blockId, classHash)` | `ContractClass` | Contract class by hash |
| `getClassAt(blockId, address)` | `ContractClass` | Contract class at address |
| `getClassHashAt(blockId, address)` | `string` | Class hash at address |

### Transactions

| Function | Return Type | Description |
|----------|-------------|-------------|
| `getTransactionByHash(txHash)` | `TxnWithHash` | Transaction by hash |
| `getTransactionByBlockIdAndIndex(blockId, index)` | `TxnWithHash` | Transaction by position |
| `getTransactionReceipt(txHash)` | `TxnReceiptWithBlockInfo` | Transaction receipt |
| `getTransactionStatus(txHash)` | `TransactionStatus` | Transaction status |
| `getMessagesStatus(txHash)` | `MessagesStatusResponse` | L1↔L2 message status |

### Events

| Function | Return Type | Description |
|----------|-------------|-------------|
| `getEvents(filter)` | `EventsResponse` | Query events with filters |

### Tracing

| Function | Return Type | Description |
|----------|-------------|-------------|
| `traceTransaction(txHash)` | `TransactionTrace` | Execution trace for transaction |
| `traceBlockTransactions(blockId)` | `BlockTransactionTrace[]` | All traces in a block |

### Write Operations

| Function | Return Type | Description |
|----------|-------------|-------------|
| `addInvokeTransaction(tx)` | `AddInvokeTransactionResult` | Submit invoke transaction |
| `addDeclareTransaction(tx)` | `AddDeclareTransactionResult` | Submit declare transaction |
| `addDeployAccountTransaction(tx)` | `AddDeployAccountTransactionResult` | Submit deploy account transaction |

### Simulation & Estimation

| Function | Return Type | Description |
|----------|-------------|-------------|
| `estimateFee(txs, flags?, blockId?)` | `FeeEstimate[]` | Estimate fees for transactions |
| `estimateMessageFee(msg, blockId?)` | `MessageFeeEstimate` | Estimate L1→L2 message fee |
| `simulateTransactions(txs, flags?, blockId?)` | `SimulatedTransaction[]` | Simulate transactions |

### Low-Level

| Function | Return Type | Description |
|----------|-------------|-------------|
| `request(method, params?)` | `T` | Raw RPC call (generic) |

<Info>
Subscription methods (`starknet_subscribeNewHeads`, etc.) are deferred until `Effect.Stream` integration is added.
</Info>

## Error Handling

All functions surface the same two error types:

```typescript
import { Effect } from "effect";
import { JsonRpc, Presets } from "@kundera-sn/kundera-effect";

const program = JsonRpc.blockNumber().pipe(
  Effect.catchTags({
    TransportError: (e) => {
      // Network failure: timeout, connection refused, etc.
      return Effect.succeed(-1);
    },
    RpcError: (e) => {
      // JSON-RPC error: invalid params, method not found, contract error
      // e.code: StarknetRpcErrorCode | number
      // e.method: "starknet_blockNumber"
      return Effect.succeed(-1);
    },
  }),
  Effect.provide(Presets.SepoliaProvider())
);
```

## Related

<CardGroup cols={2}>
  <Card title="Provider" icon="plug" href="/effect/services/provider">
    Underlying ProviderService used by all JsonRpc functions.
  </Card>
  <Card title="Contract" icon="file-contract" href="/effect/services/contract">
    Higher-level contract reads with ABI encoding/decoding.
  </Card>
  <Card title="Error Handling" icon="triangle-exclamation" href="/effect/guides/error-handling">
    Patterns for handling RpcError and TransportError.
  </Card>
</CardGroup>
