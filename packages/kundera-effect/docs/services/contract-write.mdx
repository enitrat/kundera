---
title: Contract Write Service
description: Write transactions with ABI encoding via wallet or account signing.
---

# Contract Write Service

`ContractWriteService` builds and submits state-changing transactions using ABI-encoded calldata. It composes `ContractService` (for encoding), `TransactionService` (for submission), and a signing service.

## Imports

```typescript
import { Services } from "@kundera-sn/kundera-effect";
// or
import {
  ContractWriteService,
  ContractWriteLive,
} from "@kundera-sn/kundera-effect/services";
```

## Service Shape

```typescript
interface ContractWriteServiceShape {
  readonly invoke: (
    params: ContractWriteParams,
    options?: ContractInvokeOptions,
  ) => Effect.Effect<AddInvokeTransactionResult, ContractError | TransactionError | RpcError | TransportError>;

  readonly invokeAndWait: (
    params: ContractWriteParams,
    options?: ContractInvokeAndWaitOptions,
  ) => Effect.Effect<TxnReceiptWithBlockInfo, ContractError | TransactionError | RpcError | TransportError>;

  readonly estimateFee: (
    params: ContractWriteParams,
    options?: EstimateContractWriteFeeOptions,
  ) => Effect.Effect<FeeEstimate, ContractError | TransactionError | RpcError | TransportError>;
}
```

## Live Layer

`ContractWriteLive` requires `ContractService` + `TransactionService`:

```typescript
import { Layer } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

// Full wallet stack includes ContractWriteService
const stack = Presets.SepoliaWalletStack({ swo: window.starknet_argentX });
```

## Write a Contract

```typescript
import { Effect } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const program = Effect.gen(function* () {
  const contractWrite = yield* Services.ContractWriteService;

  const result = yield* contractWrite.invoke({
    abi: erc20Abi,
    address: "0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7",
    functionName: "transfer",
    args: [recipientAddress, 1000n],
  });

  return result.transaction_hash;
}).pipe(
  Effect.provide(Presets.SepoliaWalletStack({ swo: window.starknet_argentX }))
);
```

## Write and Wait for Receipt

```typescript
const receipt = yield* contractWrite.invokeAndWait(
  {
    abi: erc20Abi,
    address: tokenAddress,
    functionName: "approve",
    args: [spenderAddress, amount],
  },
  {
    pollInterval: 2_000,
    maxAttempts: 30,
  }
);
```

## Estimate Fee Before Write

```typescript
const estimate = yield* contractWrite.estimateFee({
  abi: erc20Abi,
  address: tokenAddress,
  functionName: "transfer",
  args: [recipientAddress, amount],
});
// FeeEstimate { gas_consumed, gas_price, overall_fee, ... }
```

## Via Contract Factory

When using `Contract()`, write methods are available on `.write`:

```typescript
const token = yield* Services.Contract(tokenAddress, erc20Abi);
const tx = yield* token.write.transfer(recipientAddress, amount);
```

## Errors

Inherits errors from the full chain: `ContractError` (encoding), `TransactionError` (submission), `RpcError` (node rejection), `TransportError` (network).

## Related

<CardGroup cols={2}>
  <Card title="Contract Service" icon="file-contract" href="/effect/services/contract">
    Read-only contract calls.
  </Card>
  <Card title="Transaction" icon="arrow-right-arrow-left" href="/effect/services/transaction">
    Lower-level transaction submission and receipt polling.
  </Card>
  <Card title="Account" icon="user" href="/effect/services/account">
    Server-side account signing.
  </Card>
</CardGroup>
