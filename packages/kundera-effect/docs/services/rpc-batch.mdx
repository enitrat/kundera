---
title: Batch Service
description: Batch multiple RPC calls into a single HTTP request.
---

# Batch Service

`BatchService` queues multiple JSON-RPC calls and sends them as a single HTTP batch request. This reduces network round-trips when you need multiple pieces of data simultaneously.

## Imports

```typescript
import { Services } from "@kundera-sn/kundera-effect";
// or
import { BatchService, BatchLive } from "@kundera-sn/kundera-effect/services";
```

## Service Shape

```typescript
interface BatchServiceShape {
  readonly batch: <T>(
    requests: readonly BatchCallRequest[],
  ) => Effect.Effect<T[], TransportError | RpcError>;

  readonly enqueue: <T>(
    request: BatchRequest,
  ) => Effect.Effect<T, TransportError | RpcError>;
}
```

## Live Layer

`BatchLive` requires `ProviderService` and accepts optional queue config:

```typescript
import { Layer } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const stack = Layer.mergeAll(
  Presets.SepoliaProvider(),
  Services.BatchLive(),
);

// With custom config
const batchLayer = Services.BatchLive({
  maxBatchSize: 50,
  delayMs: 10,
});
```

## Batch Calls

Send multiple RPC calls in one HTTP request:

```typescript
import { Effect } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const program = Effect.gen(function* () {
  const batch = yield* Services.BatchService;

  const [blockNumber, chainId, syncing] = yield* batch.batch([
    { method: "starknet_blockNumber", params: [] },
    { method: "starknet_chainId", params: [] },
    { method: "starknet_syncing", params: [] },
  ]);

  return { blockNumber, chainId, syncing };
}).pipe(
  Effect.provide(Presets.SepoliaProvider()),
  Effect.provide(Services.BatchLive())
);
```

## Related

<CardGroup cols={2}>
  <Card title="Provider" icon="plug" href="/effect/services/provider">
    Individual RPC requests.
  </Card>
  <Card title="JSON-RPC" icon="code" href="/effect/modules/jsonrpc">
    Typed RPC wrappers (non-batched).
  </Card>
</CardGroup>
