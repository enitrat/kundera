---
title: Account Service
description: Server-side account with private key signing for invoke, declare, and deploy transactions.
---

# Account Service

`AccountService` provides server-side transaction signing using a private key. Use this for bots, scripts, and automation where no browser wallet is available.

<Warning>
`AccountService` requires a private key. Never expose private keys in client-side code. Use [WalletProviderService](/effect/services/wallet-provider) for browser environments.
</Warning>

## Imports

```typescript
import { Services } from "@kundera-sn/kundera-effect";
// or
import {
  AccountService,
  AccountLive,
  type AccountServiceShape,
} from "@kundera-sn/kundera-effect/services";
```

## Service Shape

```typescript
interface AccountServiceShape {
  readonly address: () => ContractAddressType;

  readonly signTransactionHash: (txHash: Felt252Input) =>
    Effect.Effect<string[], TransactionError>;

  readonly execute: (calls: Call | Call[], options?: AccountRequestOptions) =>
    Effect.Effect<AddInvokeTransactionResult, NonceError | TransportError | RpcError | TransactionError>;

  readonly estimateExecuteFee: (calls: Call | Call[], options?: AccountEstimateFeeOptions) =>
    Effect.Effect<FeeEstimate, NonceError | TransportError | RpcError | TransactionError>;

  readonly declare: (payload: DeclarePayload, options?: AccountRequestOptions) =>
    Effect.Effect<AddDeclareTransactionResult, NonceError | TransportError | RpcError | TransactionError>;

  readonly estimateDeclareFee: (payload: DeclarePayload, options?: AccountEstimateFeeOptions) =>
    Effect.Effect<FeeEstimate, NonceError | TransportError | RpcError | TransactionError>;

  readonly deployAccount: (payload: DeployAccountPayload, options?: AccountRequestOptions) =>
    Effect.Effect<AddDeployAccountTransactionResult, TransportError | RpcError | TransactionError>;

  readonly estimateDeployAccountFee: (payload: DeployAccountPayload, options?: AccountEstimateFeeOptions) =>
    Effect.Effect<FeeEstimate, TransportError | RpcError | TransactionError>;
}
```

## Live Layer

```typescript
import { Layer } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const account = Services.AccountLive({
  accountAddress: "0x1234...",
  privateKey: "0xabcdef...",
});

// AccountLive requires ProviderService + NonceManagerService
const stack = Layer.mergeAll(
  Presets.SepoliaProvider(),
  Services.DefaultNonceManagerLive,
  account,
);
```

### Custom Signer

Pass a `signTransaction` function instead of `privateKey` for HSM, Ledger, or custom signing:

```typescript
const account = Services.AccountLive({
  accountAddress: "0x1234...",
  signTransaction: (txHash) =>
    Effect.succeed(["0xr_value", "0xs_value"]),
});
```

## Execute Transactions

```typescript
import { Effect } from "effect";
import { Services } from "@kundera-sn/kundera-effect";

const program = Effect.gen(function* () {
  const account = yield* Services.AccountService;

  const result = yield* account.execute({
    contractAddress: "0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7",
    entrypoint: "transfer",
    calldata: [recipientAddress, amountLow, amountHigh],
  });

  return result.transaction_hash;
});
```

### Multi-call

```typescript
const result = yield* account.execute([
  {
    contractAddress: tokenAddress,
    entrypoint: "approve",
    calldata: [spenderAddress, amountLow, amountHigh],
  },
  {
    contractAddress: routerAddress,
    entrypoint: "swap",
    calldata: [tokenIn, tokenOut, amountLow, amountHigh, minOut],
  },
]);
```

## Fee Estimation

```typescript
const estimate = yield* account.estimateExecuteFee(calls, {
  blockId: "latest",
});
// FeeEstimate { gas_consumed, gas_price, overall_fee, ... }
```

## Declare and Deploy

```typescript
// Declare a contract class
const declareResult = yield* account.declare({
  contract: compiledContract,
  classHash: "0x...",
  compiledClassHash: "0x...",
});

// Deploy an account contract
const deployResult = yield* account.deployAccount({
  classHash: "0x...",
  constructorCalldata: [...],
  addressSalt: "0x...",
});
```

## Errors

| Error | When |
|-------|------|
| `TransactionError` | Signing failure, invalid transaction |
| `NonceError` | Nonce fetch or reservation failed |
| `RpcError` | Node rejected the transaction |
| `TransportError` | Network failure |

## Related

<CardGroup cols={2}>
  <Card title="Wallet Provider" icon="wallet" href="/effect/services/wallet-provider">
    Browser wallet integration (alternative to AccountService).
  </Card>
  <Card title="Nonce Manager" icon="hashtag" href="/effect/services/nonce-manager">
    Nonce tracking for concurrent transactions.
  </Card>
  <Card title="Fee Estimator" icon="calculator" href="/effect/services/fee-estimator">
    Fee estimation service.
  </Card>
</CardGroup>
