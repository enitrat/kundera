---
title: Contract Service
description: Read-only contract calls with ABI encoding and decoding.
---

<Tip>
For pre-configured contracts in a Layer, use [ContractRegistryService](/effect/services/contract-registry). It provides cleaner composition without inline contract creation.
</Tip>

# Contract Service

`ContractService` composes `ProviderService` and ABI helpers to build calls and decode outputs.

## Imports

```typescript
import { Services } from "@kundera-sn/kundera-effect";
// or
import {
  ContractService,
  ContractLive,
  Contract,
  readContract,
  simulateContract,
} from "@kundera-sn/kundera-effect/services";
```

## Service Shape

```typescript
interface ContractServiceShape {
  readonly readContract: (params: ReadContractParams) => Effect.Effect<unknown, ContractError>;
  readonly buildCall: (params: ContractCallParams) => Effect.Effect<FunctionCall, ContractError>;
  readonly callRaw: (params: ContractCallParams) => Effect.Effect<string[], ContractError>;
  readonly simulateContract: (params: SimulateContractParams) => Effect.Effect<SimulateContractResult, ContractError>;
}
```

## Live Layer

`ContractLive` requires `ProviderService`:

```typescript
import { Layer } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const stack = Layer.mergeAll(
  Presets.SepoliaProvider(),
  Services.ContractLive,
);
```

## Read Contract

```typescript
import { Effect } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";
import erc20Abi from "./erc20.abi.json";

const program = Effect.gen(function* () {
  const contract = yield* Services.ContractService;
  return yield* contract.readContract({
    abi: erc20Abi,
    address: "0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7",
    functionName: "balanceOf",
    args: ["0x1234..."],
    blockId: "latest",
  });
}).pipe(
  Effect.provide(Presets.SepoliaProvider()),
  Effect.provide(Services.ContractLive)
);
```

## Contract Factory (Type-Safe)

`Contract` generates a type-safe API surface from an `as const` ABI:

```typescript
import { Effect } from "effect";
import { Services } from "@kundera-sn/kundera-effect";
import { ContractAddress } from "@kundera-sn/kundera-ts";

const erc20Abi = [
  {
    type: "function",
    name: "balanceOf",
    inputs: [{ name: "owner", type: "core::starknet::contract_address::ContractAddress" }],
    outputs: [{ name: "balance", type: "core::integer::u256" }],
    state_mutability: "view",
  },
  {
    type: "function",
    name: "transfer",
    inputs: [
      { name: "to", type: "core::starknet::contract_address::ContractAddress" },
      { name: "amount", type: "core::integer::u256" },
    ],
    outputs: [],
    state_mutability: "external",
  },
] as const;

const program = Effect.gen(function* () {
  const token = yield* Services.Contract(
    ContractAddress("0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7"),
    erc20Abi,
  );

  // Type-safe reads — args and return types inferred from ABI
  const balance = yield* token.read.balanceOf(
    ContractAddress("0x1234...")
  );

  return balance;
});
```

## Free Functions

`readContract` and `simulateContract` are free functions that require `ContractService`:

```typescript
import { Services } from "@kundera-sn/kundera-effect";

const balance = Services.readContract({
  abi: erc20Abi,
  address: "0x...",
  functionName: "balanceOf",
  args: ["0x..."],
});
// Effect<unknown, ContractError, ContractService>
```

## Errors

```typescript
class ContractError extends Data.TaggedError("ContractError")<{
  readonly contractAddress: string;
  readonly functionName: string;
  readonly stage: "encode" | "request" | "decode" | "simulate";
  readonly message: string;
  readonly cause?: unknown;
}>
```

The `stage` field tells you where the failure happened:
- `encode` — ABI encoding of calldata failed
- `request` — RPC call failed
- `decode` — ABI decoding of result failed
- `simulate` — Transaction simulation failed

## Related

<CardGroup cols={2}>
  <Card title="Contract Registry" icon="layer-group" href="/effect/services/contract-registry">
    Pre-configured contract instances in a Layer.
  </Card>
  <Card title="Contract Write" icon="pen" href="/effect/services/contract-write">
    Write transactions via wallet or account.
  </Card>
  <Card title="Provider" icon="plug" href="/effect/services/provider">
    Underlying RPC provider.
  </Card>
</CardGroup>
