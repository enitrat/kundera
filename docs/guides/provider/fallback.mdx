---
title: Fallback Provider
description: Multi-endpoint failover for reliability.
---

Fallback providers automatically switch between multiple RPC endpoints when one fails, ensuring high availability for production applications.

## Basic Setup

```typescript
import { fallbackTransport, httpTransport } from 'kundera/transport';
import { HttpProvider } from 'kundera/provider';

// Create a fallback transport with multiple endpoints
const transport = fallbackTransport({
  transports: [
    httpTransport({ url: 'https://primary-rpc.example.com' }),
    httpTransport({ url: 'https://backup-rpc.example.com' }),
    httpTransport({ url: 'https://starknet-mainnet.public.blastapi.io' }),
  ],
});

// Use with provider (requires custom wiring)
// The provider will automatically failover on errors
```

## Failover Behavior

When a request fails, the fallback transport:

1. Catches the error from the current transport
2. Moves to the next transport in the list
3. Retries the request
4. Returns the first successful response

```typescript
const transport = fallbackTransport({
  transports: [
    httpTransport({ url: 'https://unreliable.example.com' }),
    httpTransport({ url: 'https://reliable.example.com' }),
  ],
});

// If first endpoint fails, automatically tries second
const block = await transport.request({
  method: 'starknet_blockNumber',
  params: [],
});
```

<Tip>
Order endpoints by preference: fastest/cheapest first, most reliable last.
</Tip>

## With Per-Endpoint Configuration

Each transport can have its own settings:

```typescript
const transport = fallbackTransport({
  transports: [
    // Fast premium endpoint with short timeout
    httpTransport({
      url: 'https://premium-rpc.example.com',
      timeout: 5000,
      retry: 1,
      headers: { 'Authorization': 'Bearer ...' },
    }),
    // Reliable public endpoint with longer timeout
    httpTransport({
      url: 'https://starknet-mainnet.public.blastapi.io',
      timeout: 30000,
      retry: 3,
    }),
  ],
});
```

## Error Handling

Fallback transport throws only after all endpoints fail:

```typescript
try {
  const result = await transport.request({
    method: 'starknet_blockNumber',
    params: [],
  });
} catch (error) {
  // All endpoints failed
  console.error('All RPC endpoints unavailable:', error);
}
```

<Warning>
## Rate Limits

If an endpoint returns a rate limit error (429), the fallback immediately moves to the next endpoint. Consider using different API keys per endpoint.
</Warning>

## Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `transports` | `Transport[]` | required | Ordered list of fallback transports |
| `retryAll` | `boolean` | `true` | Retry entire list on failure |

## Use Cases

### Geographic Distribution

```typescript
const transport = fallbackTransport({
  transports: [
    httpTransport({ url: 'https://us-east.rpc.example.com' }),
    httpTransport({ url: 'https://eu-west.rpc.example.com' }),
    httpTransport({ url: 'https://asia.rpc.example.com' }),
  ],
});
```

### Tiered Providers

```typescript
const transport = fallbackTransport({
  transports: [
    // Premium (paid, fast)
    httpTransport({ url: process.env.PREMIUM_RPC_URL! }),
    // Standard (shared, rate-limited)
    httpTransport({ url: process.env.STANDARD_RPC_URL! }),
    // Public (free, slow)
    httpTransport({ url: 'https://starknet-mainnet.public.blastapi.io' }),
  ],
});
```

## Related

<CardGroup cols={2}>
  <Card title="HTTP Provider" icon="plug" href="/guides/provider/http">
    Single-endpoint HTTP provider.
  </Card>
  <Card title="Transport Layer" icon="layer-group" href="/guides/provider/transport">
    Low-level transport concepts.
  </Card>
</CardGroup>
