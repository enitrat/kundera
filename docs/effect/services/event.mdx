---
title: Event Service
description: Query, filter, and decode Starknet contract events.
---

# Event Service

`EventService` provides event querying and ABI-based event decoding. It wraps `starknet_getEvents` with type-safe filtering and optional ABI decoding.

## Imports

```typescript
import { Services } from "@kundera-sn/kundera-effect";
// or
import {
  EventService,
  EventLive,
} from "@kundera-sn/kundera-effect/services";
```

## Service Shape

```typescript
interface EventServiceShape {
  readonly getEvents: (
    filter: EventsFilter,
    options?: EventReadOptions,
  ) => Effect.Effect<EventsResponse, TransportError | RpcError>;

  readonly watchEvents: (
    options: WatchEventsOptions,
  ) => Stream.Stream<EmittedEvent, TransportError | RpcError>;

  readonly decodeEvent: (
    params: DecodeEventParams,
  ) => Effect.Effect<DecodedEvent, ContractError>;

  readonly watchDecodedEvents: (
    options: WatchDecodedEventsOptions,
  ) => Stream.Stream<DecodedEvent, TransportError | RpcError | ContractError>;
}
```

## Live Layer

`EventLive` requires `ProviderService`:

```typescript
import { Layer } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const stack = Layer.mergeAll(
  Presets.SepoliaProvider(),
  Services.EventLive,
);
```

<Info>
`EventLive` is included automatically in wallet stacks.
</Info>

## Query Events

```typescript
import { Effect } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const program = Effect.gen(function* () {
  const events = yield* Services.EventService;

  const response = yield* events.getEvents({
    from_block: { block_number: 100_000 },
    to_block: { block_number: 100_100 },
    address: "0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7",
    keys: [["0x0099cd8bde557814842a3121e8ddfd433a539b8c9f14bf31ebf108d12e6196e9"]], // Transfer key
    chunk_size: 100,
  });

  return response.events;
}).pipe(
  Effect.provide(Presets.SepoliaProvider()),
  Effect.provide(Services.EventLive)
);
```

## Decode Events

Decode raw event data using an ABI:

```typescript
const decoded = yield* events.decodeEvent({
  event,              // full EmittedEvent object
  abi: erc20Abi,
  eventNameOrSelector: "Transfer",  // optional: filter by name or selector
});
```

## Watch Events

`watchEvents` and `watchDecodedEvents` return `Stream.Stream`, not `Effect.Effect`. Use `Stream.runForEach` to consume:

```typescript
import { Effect, Stream } from "effect";
import { Services, Presets } from "@kundera-sn/kundera-effect";

const program = Effect.gen(function* () {
  const events = yield* Services.EventService;

  // Watch raw events — polls at the given interval
  const stream = events.watchEvents({
    filter: {
      from_block: "latest",
      address: tokenAddress,
      keys: [["0x0099cd8bde557814842a3121e8ddfd433a539b8c9f14bf31ebf108d12e6196e9"]],
      chunk_size: 100,
    },
    pollInterval: "5 seconds",
  });

  // Consume the first 10 events
  yield* Stream.runForEach(
    Stream.take(stream, 10),
    (event) => Effect.log(`Transfer from ${event.from_address}`),
  );
});

// Watch decoded events — same pattern with ABI decoding
const decodedProgram = Effect.gen(function* () {
  const events = yield* Services.EventService;

  const stream = events.watchDecodedEvents({
    filter: {
      from_block: "latest",
      address: tokenAddress,
      keys: [["0x0099cd8bde557814842a3121e8ddfd433a539b8c9f14bf31ebf108d12e6196e9"]],
      chunk_size: 100,
    },
    abi: erc20Abi,
    eventNameOrSelector: "Transfer",
    pollInterval: "5 seconds",
  });

  yield* Stream.runForEach(stream, (decoded) =>
    Effect.log(`Decoded transfer: ${JSON.stringify(decoded)}`),
  );
});
```

<Info>
Both `watchEvents` and `watchDecodedEvents` deduplicate events by `(block_hash, tx_hash, from_address, keys, data)`. Duplicate events from overlapping poll windows are automatically dropped.
</Info>

## Related

<CardGroup cols={2}>
  <Card title="Event Filtering" icon="filter" href="/shared/event-filtering">
    Cross-package event filtering patterns.
  </Card>
  <Card title="JSON-RPC" icon="code" href="/effect/modules/jsonrpc">
    Low-level `getEvents` RPC call.
  </Card>
</CardGroup>
