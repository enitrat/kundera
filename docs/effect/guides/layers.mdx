---
title: Layers and Dependency Injection
description: Learn how to use Effect layers for dependency management
---

# Layers and Dependency Injection

Effect's layer system provides a powerful way to manage dependencies in your Starknet applications.

## What are Layers?

Layers are Effect's solution for dependency injection. They define how to construct and provide services to your program.

```typescript
import { ProviderService } from "@kundera-sn/kundera-effect/services"
import { Effect, Layer } from "effect"

// Define a layer
const ProviderLive = ProviderService.layer({
  url: "https://starknet-sepolia.public.blastapi.io"
})

// Use the layer
const program = Effect.gen(function* () {
  const provider = yield* ProviderService
  return yield* provider.getBlockNumber()
})

// Provide the layer
const result = await Effect.runPromise(
  program.pipe(Effect.provide(ProviderLive))
)
```

## Combining Multiple Services

Use `Layer.mergeAll` to combine multiple service layers:

```typescript
import { ProviderService, AccountService } from "@kundera-sn/kundera-effect/services"
import { Layer } from "effect"

const AppLive = Layer.mergeAll(
  ProviderService.layer({ url: "https://..." }),
  AccountService.layer({
    address: "0x...",
    privateKey: "0x..."
  })
)

const program = Effect.gen(function* () {
  const provider = yield* ProviderService
  const account = yield* AccountService

  // Both services are available
})

Effect.runPromise(program.pipe(Effect.provide(AppLive)))
```

## Testing with Mock Layers

Create test layers for easy mocking:

```typescript
const ProviderTest = ProviderService.test({
  blockNumber: 12345n,
  chainId: "SN_SEPOLIA"
})

// Swap implementation for testing
const testResult = await Effect.runPromise(
  program.pipe(Effect.provide(ProviderTest))
)
```

## Layer Composition

Layers can depend on other layers:

```typescript
const DatabaseLayer = Layer.effect(
  DatabaseService,
  Effect.gen(function* () {
    const config = yield* ConfigService
    return new Database(config.url)
  })
)

// DatabaseLayer requires ConfigService
const AppLayer = Layer.mergeAll(
  ConfigLayer,
  DatabaseLayer
)
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Services" icon="server" href="/effect/services/provider">
    Explore available services
  </Card>

  <Card title="Testing" icon="flask" href="/effect/guides/testing">
    Learn testing patterns
  </Card>

  <Card title="Error Handling" icon="shield" href="/effect/guides/error-handling">
    Handle errors properly
  </Card>

  <Card title="Effect Docs" icon="book" href="https://effect.website">
    Official Effect documentation
  </Card>
</CardGroup>
