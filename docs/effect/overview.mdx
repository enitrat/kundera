---
title: "Kundera Effect"
description: Effect-TS integration for type-safe, composable Starknet operations
---

# @kundera-sn/kundera-effect

**For production applications, we recommend @kundera-sn/kundera-effect** — Effect-TS integration with typed errors, dependency injection, and composable operations.

## Why Effect?

| Feature | Plain Kundera | @kundera-sn/kundera-effect |
|---------|---------------|----------------|
| Error handling | try/catch | Typed `Effect<A, E, R>` |
| Retries | Manual | `Effect.retry({ times: 3 })` |
| Timeouts | Manual | `Effect.timeout("10s")` |
| Composition | Promise chains | Effect generators |
| Testing | Mocks | Dependency injection |

## Quick Comparison

**Plain Kundera:**
```typescript
import { encodeCalldata } from '@kundera-sn/kundera-ts/abi';
import { starknet_call } from '@kundera-sn/kundera-ts/jsonrpc';

try {
  const address = '0x...';
  const encoded = encodeCalldata(abi, 'transfer', args);
  if (encoded.error) {
    throw encoded.error;
  }
  const result = await starknet_call(
    transport,
    {
      contract_address: address,
      entry_point_selector: '0x...',
      calldata: encoded.result
    },
    'latest'
  );
} catch (e) {
  // What kind of error? ABI? JSON-RPC? Network?
}
```

**@kundera-sn/kundera-effect:**
```typescript
import { Effect } from 'effect';
import * as Abi from '@kundera-sn/kundera-effect/abi';
import * as Rpc from '@kundera-sn/kundera-effect/jsonrpc';

const program = Effect.gen(function* () {
  const calldata = yield* Abi.encodeCalldata(abi, 'transfer', args);
  const result = yield* Rpc.starknet_call(transport, call, 'latest');
  return result;
}).pipe(
  Effect.retry({ times: 3 }),
  Effect.timeout('10 seconds'),
  Effect.catchTag('RpcError', (e) => Effect.succeed(fallback))
);
```

## ContractRegistryService Pattern

The recommended way to interact with contracts is using `ContractRegistryService` — pre-configure your contracts in a Layer for cleaner Effect composition:

```typescript
import { Effect, Layer } from 'effect';
import { Services } from '@kundera-sn/kundera-effect';

// Define your contracts once
const ERC20_ABI = [
  { type: "function", name: "balanceOf", inputs: [...], outputs: [...], state_mutability: "view" },
  { type: "function", name: "transfer", inputs: [...], outputs: [], state_mutability: "external" },
] as const;

const ContractsLayer = Services.Contract.makeContractRegistry({
  ETH: { abi: ERC20_ABI, address: '0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7' },
  STRK: { abi: ERC20_ABI, address: '0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d' },
  ERC20: { abi: ERC20_ABI }, // Factory - no address, use .at() at runtime
});

// Clean Effect.gen - no inline contract creation
const program = Effect.gen(function* () {
  const { ETH, STRK, ERC20 } = yield* Services.Contract.ContractRegistryService;

  // Pre-addressed: use directly with full type safety
  const ethBalance = yield* ETH.read.balanceOf(userAddress);
  const strkBalance = yield* STRK.read.balanceOf(userAddress);

  // Factory: create at runtime address
  const customToken = ERC20.at(dynamicAddress);
  const customBalance = yield* customToken.read.balanceOf(userAddress);

  return { ethBalance, strkBalance, customBalance };
}).pipe(
  Effect.provide(ContractsLayer),
  Effect.provide(Services.Contract.ContractLayer),
  Effect.provide(Services.Presets.createHttpProvider('https://starknet.example.com'))
);
```

<Info>
See the [Contract Registry Guide](/effect/services/contract-registry) for complete documentation.
</Info>

## Installation

```bash
npm install @kundera-sn/kundera-effect effect @kundera-sn/kundera-ts
```

## Modules

<CardGroup cols={2}>
  <Card title="Primitives" icon="cube" href="/effect/primitives">
    Felt252, ContractAddress, ClassHash with Effect wrappers.
  </Card>
  <Card title="ABI" icon="code" href="/effect/modules/abi">
    Encode and decode calldata with typed AbiError.
  </Card>
  <Card title="Crypto" icon="lock" href="/effect/modules/crypto">
    Pedersen, Poseidon, signatures with CryptoError.
  </Card>
  <Card title="JSON-RPC" icon="network-wired" href="/effect/modules/jsonrpc">
    All JSON-RPC methods with RpcError handling.
  </Card>
  <Card title="Serde" icon="arrows-rotate" href="/effect/modules/serde">
    Cairo serialization with SerdeError.
  </Card>
  <Card title="Transport" icon="satellite" href="/effect/modules/transport">
    HTTP and WebSocket with TransportError.
  </Card>
  <Card title="Services" icon="layer-group" href="/effect/services">
    Transport/Provider/RpcBatch layers with DI presets.
  </Card>
</CardGroup>

## Error Types

All operations return typed errors you can pattern match:

```typescript
import { Effect } from 'effect';

const program = myOperation.pipe(
  Effect.catchTags({
    PrimitiveError: (e) => /* handle invalid felt/address */,
    AbiError: (e) => /* handle encoding/decoding failure */,
    CryptoError: (e) => /* handle hash/signature failure */,
    RpcError: (e) => /* handle network/JSON-RPC failure */,
  })
);
```

## Full Documentation

See the [@kundera-sn/kundera-effect package](https://github.com/starknet/kundera/tree/master/packages/kundera-effect/docs) for complete API documentation.
