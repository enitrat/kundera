---
title: Effect Integration
sidebarTitle: Overview
description: Type-safe Starknet development with Effect-TS services, composable layers, and explicit error tracking.
---

`@kundera-sn/kundera-effect` wraps [`@kundera-sn/kundera-ts`](/typescript/index) with Effect-TS services. Every RPC call, wallet interaction, and contract operation returns an `Effect<A, E, R>` where errors and dependencies are tracked at compile time.

## Why Effect?

| Problem | starknet.js | kundera-effect |
|---------|-------------|----------------|
| Hidden errors | `try/catch` around everything | Typed error channel — `TransportError \| RpcError` |
| Global config | Mutable provider instances | Immutable layers, fiber-local overrides |
| Testing | Mock HTTP or monkey-patch | Swap layers — `TestTransport`, `TestProvider` |
| Concurrency | Manual `Promise.all` | `Effect.forEach`, `Effect.retry`, `Schedule` |
| Dependencies | Constructor injection, singletons | `Context.Tag` + `Layer` — compile-time DI |

## Quick Example

```typescript
import { Effect } from "effect";
import { JsonRpc, Presets } from "@kundera-sn/kundera-effect";

const program = JsonRpc.blockNumber().pipe(
  Effect.provide(Presets.SepoliaProvider())
);

const blockNum = await Effect.runPromise(program);
```

## Architecture

```
@kundera-sn/kundera-effect
├── Services      — Context.Tag services with Layer implementations
├── JsonRpc       — Free-function RPC wrappers (one per Starknet method)
├── Presets        — Pre-composed layers (Mainnet, Sepolia, Devnet, Wallet stacks)
├── Primitives    — Effect Schema wrappers for kundera-ts types
└── Testing       — TestTransport + TestProvider for unit tests
```

### Layer Dependency Graph

```
TransportService (HTTP / WebSocket connection)
  └─ ProviderService (JSON-RPC request / response)
       ├─ ChainService (chain ID, network info)
       ├─ FeeEstimatorService (fee estimation)
       ├─ NonceManagerService (nonce tracking)
       ├─ ContractService (read calls, ABI encoding)
       ├─ BlockStreamService (block backfill + live watch + reorg detection)
       ├─ TransactionStreamService (pending/confirmed/track streams)
       ├─ EventService (event filtering + decoding)
       └─ BatchService (batched RPC requests)

AccountService (server-side signing)
  ├─ requires ProviderService + NonceManagerService

WalletProviderService (browser wallet via SNIP standards)
  └─ TransactionService (send + wait for receipt)
       └─ ContractWriteService (write calls via wallet)
```

## Package Exports

```typescript
import { Services, JsonRpc, Presets, Primitives } from "@kundera-sn/kundera-effect";
import { TransportError, RpcError } from "@kundera-sn/kundera-effect/errors";
import { TestTransport, TestProvider } from "@kundera-sn/kundera-effect/testing";
```

| Subpath | Contents |
|---------|----------|
| `@kundera-sn/kundera-effect` | Namespaced re-exports (`Services`, `JsonRpc`, `Presets`, `Primitives`) |
| `@kundera-sn/kundera-effect/errors` | All error classes (`TransportError`, `RpcError`, `WalletError`, etc.) |
| `@kundera-sn/kundera-effect/services` | All service tags, shapes, layers, and stack presets |
| `@kundera-sn/kundera-effect/jsonrpc` | Free-function RPC wrappers |
| `@kundera-sn/kundera-effect/presets` | Network presets and wallet stacks |
| `@kundera-sn/kundera-effect/primitives` | Effect Schema wrappers |
| `@kundera-sn/kundera-effect/testing` | `TestTransport`, `TestProvider` |

## Philosophy

**kundera-ts is the source of truth.** kundera-effect wraps it — never reimplements. Wire types, primitives, transport, ABI encoding, and crypto all come from kundera-ts. kundera-effect adds:

1. **Services** — `Context.Tag` + `Layer` for dependency injection
2. **Error tracking** — `Data.TaggedError` in the Effect error channel
3. **Composability** — `FiberRef` for fiber-local config (timeout, retries, interceptors)
4. **Testing** — Layer-swappable mocks

<Tip>
New to Effect? Start with [Effect.gen](https://effect.website/docs/getting-started/using-generators) and [Services](https://effect.website/docs/requirements-management/services). The rest follows naturally.
</Tip>

## Next Steps

<CardGroup cols={2}>
  <Card title="React Integration" icon="react" href="/effect/guides/react-integration">
    effect-atom patterns for reactive Starknet dApps.
  </Card>
  <Card title="TanStack Query" icon="react" href="/effect/guides/tanstack-query">
    TanStack Query integration for familiar React data-fetching.
  </Card>
  <Card title="JSON-RPC" icon="code" href="/effect/modules/jsonrpc">
    Call any Starknet RPC method.
  </Card>
  <Card title="Contract Service" icon="file-contract" href="/effect/services/contract">
    Read contracts with ABI decoding.
  </Card>
  <Card title="Layers" icon="layer-group" href="/effect/guides/layers">
    Compose once, provide once — service graph and layer composition.
  </Card>
  <Card title="Provider Fallback" icon="rotate" href="/effect/guides/provider-fallback">
    Multi-endpoint retry and fallback strategies.
  </Card>
  <Card title="Error Handling" icon="triangle-exclamation" href="/effect/guides/error-handling">
    Type-safe error handling patterns.
  </Card>
  <Card title="Debugging" icon="bug" href="/effect/guides/debugging">
    Transport interceptors, logging, and tracing.
  </Card>
  <Card title="Security" icon="shield" href="/effect/guides/security">
    Wallet secrets, safe logging, and key redaction.
  </Card>
  <Card title="Migrating from starknet.js" icon="arrow-right" href="/effect/guides/migrating-from-starknetjs">
    Side-by-side migration guide.
  </Card>
  <Card title="Testing" icon="flask" href="/effect/guides/testing">
    Mock services with TestTransport.
  </Card>
  <Card title="Presets" icon="sliders" href="/effect/modules/presets">
    Pre-composed layers for common setups.
  </Card>
</CardGroup>
