---
title: Native Crypto
description: Use native crypto for maximum performance in Bun and Node.
---

Native crypto provides the fastest signing and hashing operations by using Rust bindings via FFI. This is recommended for backend services and CLI tools.

## Bun (Automatic)

Bun automatically uses native crypto via its built-in FFI. No additional setup required.

```typescript
import { isNativeAvailable } from 'kundera/crypto';

console.log('Native available:', isNativeAvailable());
// true in Bun
```

<Tip>
Bun's FFI is the fastest option. If you're building a backend service, Bun is recommended.
</Tip>

## Node.js with ffi-napi

Node.js requires the `ffi-napi` package for native crypto:

```bash
npm install ffi-napi
```

Then Kundera automatically detects and uses it:

```typescript
import { isNativeAvailable } from 'kundera/crypto';

console.log('Native available:', isNativeAvailable());
// true if ffi-napi is installed
```

<Warning>
## Native Dependencies

`ffi-napi` requires native build tools:

**macOS:**
```bash
xcode-select --install
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get install build-essential
```

**Windows:**
```bash
npm install --global windows-build-tools
```
</Warning>

## Library Path

Kundera looks for the native library (`libkundera_crypto.dylib`, `.so`, or `.dll`) in these locations:

1. `KUNDERA_NATIVE_LIB` environment variable
2. Adjacent to the package: `node_modules/kundera/native/`
3. System library paths

To specify a custom path:

```bash
export KUNDERA_NATIVE_LIB=/path/to/libkundera_crypto.dylib
```

## Fallback to WASM

If native crypto is unavailable, Kundera falls back to WASM:

```typescript
import { isNativeAvailable, isWasmLoaded, loadWasmCrypto } from 'kundera/crypto';

if (!isNativeAvailable()) {
  console.log('Native unavailable, loading WASM...');
  await loadWasmCrypto();
  console.log('WASM loaded:', isWasmLoaded());
}
```

## Performance Comparison

| Operation | Native (Bun) | WASM | JS (fallback) |
|-----------|-------------|------|---------------|
| Pedersen hash | ~50μs | ~200μs | ~2ms |
| Poseidon hash | ~30μs | ~150μs | ~1.5ms |
| ECDSA sign | ~100μs | ~400μs | ~5ms |
| ECDSA verify | ~150μs | ~500μs | ~6ms |

## Related

<CardGroup cols={2}>
  <Card title="WASM Crypto" icon="browser" href="/getting-started/wasm">
    Use WASM for browsers and portable environments.
  </Card>
  <Card title="Compatibility" icon="check" href="/getting-started/compatibility">
    Full runtime compatibility matrix.
  </Card>
</CardGroup>
